<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PenBug - Messages</title>
    <link rel="stylesheet" href="main.css">
    <link rel="icon" href="assets/logo-primary.svg" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Messages Specific Styles */
        .messages-container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            height: 80vh;
        }
        
        .conversations-sidebar {
            background: var(--bg-tertiary);
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .conversations-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .conversations-search {
            margin-bottom: 1rem;
        }
        
        .conversations-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .conversation-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .conversation-item:hover, .conversation-item.active {
            background: rgba(255, 0, 0, 0.1);
        }
        
        .conversation-item.unread {
            background: rgba(255, 0, 0, 0.05);
        }
        
        .conversation-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }
        
        .conversation-info {
            flex: 1;
            min-width: 0;
        }
        
        .conversation-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .conversation-preview {
            color: var(--text-muted);
            font-size: 0.875rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .conversation-meta {
            text-align: right;
            flex-shrink: 0;
        }
        
        .conversation-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }
        
        .unread-badge {
            background: var(--accent-primary);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: auto;
        }
        
        .chat-window {
            background: var(--bg-tertiary);
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chat-participants {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .chat-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message {
            max-width: 70%;
            padding: 1rem;
            border-radius: 15px;
            position: relative;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.sent {
            background: var(--accent-primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .message.received {
            background: var(--bg-secondary);
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .message-time {
            font-size: 0.75rem;
            margin-top: 0.5rem;
            opacity: 0.8;
            text-align: right;
        }
        
        .message-status {
            position: absolute;
            bottom: 0.5rem;
            right: 0.75rem;
            font-size: 0.75rem;
        }
        
        .message.received .message-time {
            text-align: left;
        }
        
        .chat-input-area {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        
        .chat-input-container {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
        }
        
        .chat-input {
            flex: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 25px;
            padding: 1rem 1.5rem;
            color: var(--text-primary);
            resize: none;
            min-height: 50px;
            max-height: 150px;
            font-family: inherit;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }
        
        .chat-input-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .attachment-btn, .send-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            font-size: 1.25rem;
        }
        
        .attachment-btn {
            background: var(--bg-secondary);
            color: var(--text-secondary);
        }
        
        .send-btn {
            background: var(--accent-primary);
            color: white;
        }
        
        .no-conversation-selected {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-muted);
            text-align: center;
            padding: 2rem;
        }
        
        .no-conversation-selected i {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 1024px) {
            .messages-container {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .conversations-sidebar {
                height: 400px;
            }
            
            .chat-window {
                height: 500px;
            }
        }
        
        @media (max-width: 768px) {
            .conversation-item {
                padding: 0.75rem 1rem;
            }
            
            .chat-header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
            
            .chat-actions {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav container">
            <div class="logo">PenBug</div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="programs.html">Programs</a></li>
                <li><a href="leaderboard.html">Leaderboard</a></li>
                <li><a href="submissions.html">Submissions</a></li>
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="profile.html">Profile</a></li>
                <li><a href="notifications.html" class="nav-login-btn">
                    <i class="fas fa-bell"></i>
                </a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <div style="margin-bottom: 2rem;">
            <h1>Messages</h1>
            <p class="text-secondary">Communicate securely with program administrators and other researchers</p>
        </div>

        <div class="messages-container">
            <!-- Conversations Sidebar -->
            <div class="conversations-sidebar">
                <div class="conversations-header">
                    <div class="conversations-search">
                        <input type="text" placeholder="Search conversations..." style="width: 100%; padding: 0.75rem 1rem; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-primary);">
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn" style="flex: 1;" id="newMessageBtn">
                            <i class="fas fa-plus"></i> New Message
                        </button>
                        <button class="btn btn-secondary" id="filterBtn">
                            <i class="fas fa-filter"></i>
                        </button>
                    </div>
                </div>
                
                <div class="conversations-list">
                    <!-- Conversation 1 (Active) -->
                    <div class="conversation-item active unread" data-conversation="techcorp">
                        <div class="conversation-avatar" style="background: linear-gradient(135deg, #00ccff, #0099cc);">TC</div>
                        <div class="conversation-info">
                            <div class="conversation-name">TechCorp Security Team</div>
                            <div class="conversation-preview">
                                <i class="fas fa-reply" style="margin-right: 0.25rem;"></i>
                                Regarding your SQL injection submission...
                            </div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">10:30 AM</div>
                            <div class="unread-badge">3</div>
                        </div>
                    </div>
                    
                    <!-- Conversation 2 -->
                    <div class="conversation-item" data-conversation="finance">
                        <div class="conversation-avatar" style="background: linear-gradient(135deg, #00ff9d, #00cc7d);">FS</div>
                        <div class="conversation-info">
                            <div class="conversation-name">FinanceSecure Support</div>
                            <div class="conversation-preview">Additional information needed for XSS report</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">Yesterday</div>
                        </div>
                    </div>
                    
                    <!-- Conversation 3 -->
                    <div class="conversation-item unread" data-conversation="researcher">
                        <div class="conversation-avatar" style="background: linear-gradient(135deg, #ff3366, #cc0000);">JD</div>
                        <div class="conversation-info">
                            <div class="conversation-name">@john_doe</div>
                            <div class="conversation-preview">Hey! Can you help me with API testing?</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">2 days ago</div>
                            <div class="unread-badge">1</div>
                        </div>
                    </div>
                    
                    <!-- Conversation 4 -->
                    <div class="conversation-item" data-conversation="healthdata">
                        <div class="conversation-avatar" style="background: linear-gradient(135deg, #9933ff, #6600cc);">HD</div>
                        <div class="conversation-info">
                            <div class="conversation-name">HealthData Inc.</div>
                            <div class="conversation-preview">Your vulnerability has been fixed. Thank you!</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">1 week ago</div>
                        </div>
                    </div>
                    
                    <!-- Conversation 5 -->
                    <div class="conversation-item" data-conversation="penbug">
                        <div class="conversation-avatar" style="background: linear-gradient(135deg, #ffcc00, #ff9900);">PB</div>
                        <div class="conversation-info">
                            <div class="conversation-name">PenBug Support</div>
                            <div class="conversation-preview">Welcome to PenBug! Here are some tips...</div>
                        </div>
                        <div class="conversation-meta">
                            <div class="conversation-time">2 weeks ago</div>
                        </div>
                    </div>
                </div>
                
                <!-- Empty State -->
                <div class="empty-state" id="emptyConversations" style="display: none;">
                    <i class="fas fa-comments"></i>
                    <h3>No Conversations</h3>
                    <p>Start a conversation with a program administrator or another researcher.</p>
                </div>
            </div>

            <!-- Chat Window -->
            <div class="chat-window" id="chatWindow">
                <!-- Default: No conversation selected -->
                <div class="no-conversation-selected" id="noConversation">
                    <i class="fas fa-comment-dots"></i>
                    <h2>Select a conversation</h2>
                    <p>Choose a conversation from the sidebar to start messaging.</p>
                    <button class="btn" style="margin-top: 1rem;" id="startNewChatBtn">
                        <i class="fas fa-plus"></i> Start New Chat
                    </button>
                </div>
                
                <!-- Active conversation (hidden by default) -->
                <div id="activeConversation" style="display: none;">
                    <!-- Chat Header -->
                    <div class="chat-header">
                        <div class="chat-participants">
                            <div class="conversation-avatar" id="chatAvatar" style="width: 40px; height: 40px; font-size: 0.9rem;">TC</div>
                            <div>
                                <h3 id="chatName" style="margin: 0;">TechCorp Security Team</h3>
                                <p id="chatStatus" style="margin: 0; font-size: 0.875rem; color: var(--accent-primary);">
                                    <i class="fas fa-circle" style="font-size: 0.5rem;"></i> Online
                                </p>
                            </div>
                        </div>
                        <div class="chat-actions">
                            <button class="btn btn-secondary" id="callBtn">
                                <i class="fas fa-phone"></i>
                            </button>
                            <button class="btn btn-secondary" id="videoBtn">
                                <i class="fas fa-video"></i>
                            </button>
                            <button class="btn btn-secondary" id="infoBtn">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Messages Area -->
                    <div class="messages-area" id="messagesArea">
                        <!-- Date separator -->
                        <div style="text-align: center; margin: 1rem 0;">
                            <span style="background: var(--bg-tertiary); padding: 0.25rem 1rem; border-radius: 15px; font-size: 0.875rem; color: var(--text-muted);">
                                Today
                            </span>
                        </div>
                        
                        <!-- Received message -->
                        <div class="message received">
                            <div>Hi there! We've reviewed your SQL injection submission and have a few questions about the exploit chain.</div>
                            <div class="message-time">10:15 AM</div>
                        </div>
                        
                        <!-- Sent message -->
                        <div class="message sent">
                            <div>Sure! I'm happy to provide more details. What specific parts would you like me to clarify?</div>
                            <div class="message-time">10:20 AM</div>
                            <div class="message-status">
                                <i class="fas fa-check-double"></i>
                            </div>
                        </div>
                        
                        <!-- Received message -->
                        <div class="message received">
                            <div>Could you explain how you bypassed the WAF? Our logs show the requests were blocked initially.</div>
                            <div class="message-time">10:25 AM</div>
                        </div>
                        
                        <!-- Sent message -->
                        <div class="message sent">
                            <div>I used encoded characters and fragmented the payload across multiple parameters. The WAF was looking for complete patterns.</div>
                            <div class="message-time">10:28 AM</div>
                            <div class="message-status">
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                        
                        <!-- Received message -->
                        <div class="message received">
                            <div>That's very helpful. We're testing the fix now. Would you be available for a follow-up call to discuss this further?</div>
                            <div class="message-time">10:30 AM</div>
                        </div>
                    </div>
                    
                    <!-- Chat Input -->
                    <div class="chat-input-area">
                        <div class="chat-input-container">
                            <div style="flex: 1; position: relative;">
                                <textarea class="chat-input" id="messageInput" placeholder="Type your message here..." rows="1"></textarea>
                                <div style="position: absolute; bottom: 0.75rem; right: 1rem; color: var(--text-muted); font-size: 0.875rem;">
                                    <span id="charCount">0/1000</span>
                                </div>
                            </div>
                            <div class="chat-input-actions">
                                <button class="attachment-btn" id="attachBtn">
                                    <i class="fas fa-paperclip"></i>
                                </button>
                                <button class="send-btn" id="sendBtn">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-muted); text-align: center;">
                            <i class="fas fa-lock"></i> Messages are end-to-end encrypted
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- New Message Modal -->
        <div id="newMessageModal" class="card" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 500px; z-index: 1000;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin: 0;">New Message</h2>
                <button id="closeNewMessageBtn" style="background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="newMessageForm">
                <div class="form-group">
                    <label for="recipientType">Send to</label>
                    <select id="recipientType" style="margin-bottom: 1rem;">
                        <option value="program">Bug Bounty Program</option>
                        <option value="researcher">Researcher</option>
                        <option value="company">Company</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="recipientSearch">Search</label>
                    <input type="text" id="recipientSearch" placeholder="Search programs, researchers, or companies...">
                </div>
                
                <div class="recipient-list" style="max-height: 200px; overflow-y: auto; margin: 1rem 0; border: 1px solid var(--border-color); border-radius: 5px;">
                    <div class="recipient-option" style="padding: 0.75rem 1rem; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: background 0.3s;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #00ccff, #0099cc); display: flex; align-items: center; justify-content: center; font-weight: bold; color: white;">TC</div>
                            <div>
                                <div style="font-weight: bold;">TechCorp Security Team</div>
                                <div style="font-size: 0.875rem; color: var(--text-muted);">Bug Bounty Program</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recipient-option" style="padding: 0.75rem 1rem; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: background 0.3s;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #ff3366, #cc0000); display: flex; align-items: center; justify-content: center; font-weight: bold; color: white;">JD</div>
                            <div>
                                <div style="font-weight: bold;">@john_doe</div>
                                <div style="font-size: 0.875rem; color: var(--text-muted);">Researcher • Elite</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recipient-option" style="padding: 0.75rem 1rem; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: background 0.3s;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #00ff9d, #00cc7d); display: flex; align-items: center; justify-content: center; font-weight: bold; color: white;">FS</div>
                            <div>
                                <div style="font-weight: bold;">FinanceSecure Support</div>
                                <div style="font-size: 0.875rem; color: var(--text-muted);">Bug Bounty Program</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="messageSubject">Subject (Optional)</label>
                    <input type="text" id="messageSubject" placeholder="Regarding your submission...">
                </div>
                
                <div class="form-group">
                    <label for="initialMessage">Message</label>
                    <textarea id="initialMessage" rows="4" placeholder="Type your message here..." required></textarea>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn" style="flex: 1;">Send Message</button>
                    <button type="button" id="cancelNewMessageBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </form>
        </div>
        
        <!-- Modal Overlay -->
        <div id="modalOverlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 999;"></div>
    </main>

    <footer class="footer container text-center">
        <p>&copy; 2023 PenBug. All rights reserved. | 
            <a href="#" style="color: var(--accent-primary);">Message Guidelines</a> | 
            <a href="#" style="color: var(--accent-primary);">Security Policy</a>
        </p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const conversations = document.querySelectorAll('.conversation-item');
            const noConversation = document.getElementById('noConversation');
            const activeConversation = document.getElementById('activeConversation');
            const chatWindow = document.getElementById('chatWindow');
            const messagesArea = document.getElementById('messagesArea');
            const messageInput = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            const charCount = document.getElementById('charCount');
            
            // Modal Elements
            const newMessageModal = document.getElementById('newMessageModal');
            const modalOverlay = document.getElementById('modalOverlay');
            const newMessageBtn = document.getElementById('newMessageBtn');
            const closeNewMessageBtn = document.getElementById('closeNewMessageBtn');
            const cancelNewMessageBtn = document.getElementById('cancelNewMessageBtn');
            const startNewChatBtn = document.getElementById('startNewChatBtn');
            
            // Select conversation
            conversations.forEach(conversation => {
                conversation.addEventListener('click', function() {
                    // Remove active class from all conversations
                    conversations.forEach(c => c.classList.remove('active'));
                    // Add active class to clicked conversation
                    this.classList.add('active');
                    // Remove unread badge
                    const badge = this.querySelector('.unread-badge');
                    if (badge) badge.remove();
                    this.classList.remove('unread');
                    
                    // Show active conversation
                    noConversation.style.display = 'none';
                    activeConversation.style.display = 'block';
                    
                    // Update chat header
                    const avatar = this.querySelector('.conversation-avatar').textContent;
                    const name = this.querySelector('.conversation-name').textContent;
                    document.getElementById('chatAvatar').textContent = avatar;
                    document.getElementById('chatName').textContent = name;
                    
                    // Scroll to bottom of messages
                    messagesArea.scrollTop = messagesArea.scrollHeight;
                    
                    // Focus on input
                    messageInput.focus();
                });
            });
            
            // New message button
            newMessageBtn.addEventListener('click', openNewMessageModal);
            startNewChatBtn.addEventListener('click', openNewMessageModal);
            
            function openNewMessageModal() {
                newMessageModal.style.display = 'block';
                modalOverlay.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
            
            function closeNewMessageModal() {
                newMessageModal.style.display = 'none';
                modalOverlay.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
            
            closeNewMessageBtn.addEventListener('click', closeNewMessageModal);
            cancelNewMessageBtn.addEventListener('click', closeNewMessageModal);
            modalOverlay.addEventListener('click', closeNewMessageModal);
            
            // Recipient selection
            const recipientOptions = document.querySelectorAll('.recipient-option');
            recipientOptions.forEach(option => {
                option.addEventListener('click', function() {
                    recipientOptions.forEach(o => o.style.background = '');
                    this.style.background = 'rgba(255, 0, 0, 0.1)';
                });
            });
            
            // New message form submission
            document.getElementById('newMessageForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const recipient = document.querySelector('.recipient-option[style*="background"]');
                if (!recipient) {
                    alert('Please select a recipient.');
                    return;
                }
                
                const message = document.getElementById('initialMessage').value;
                if (!message.trim()) {
                    alert('Please enter a message.');
                    return;
                }
                
                // Simulate sending message
                alert('Message sent successfully!');
                closeNewMessageModal();
                
                // In real app, this would create new conversation
                // and redirect to that conversation
            });
            
            // Character count for message input
            messageInput.addEventListener('input', function() {
                const length = this.value.length;
                charCount.textContent = `${length}/1000`;
                
                // Auto-resize textarea
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 150) + 'px';
                
                // Enable/disable send button
                sendBtn.disabled = length === 0 || length > 1000;
            });
            
            // Send message
            sendBtn.addEventListener('click', sendMessage);
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            function sendMessage() {
                const message = messageInput.value.trim();
                if (!message) return;
                
                // Create new message element
                const messageElement = document.createElement('div');
                messageElement.className = 'message sent';
                messageElement.innerHTML = `
                    <div>${message}</div>
                    <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                    <div class="message-status">
                        <i class="fas fa-check"></i>
                    </div>
                `;
                
                // Add to messages area
                messagesArea.appendChild(messageElement);
                
                // Clear input
                messageInput.value = '';
                messageInput.style.height = 'auto';
                charCount.textContent = '0/1000';
                sendBtn.disabled = true;
                
                // Scroll to bottom
                messagesArea.scrollTop = messagesArea.scrollHeight;
                
                // Simulate reply after 1 second
                setTimeout(() => {
                    const replies = [
                        "Thanks for your message. We'll review it and get back to you shortly.",
                        "Could you provide more details about that?",
                        "We've received your message and will respond within 24 hours.",
                        "That's interesting. Let me check with our security team."
                    ];
                    
                    const randomReply = replies[Math.floor(Math.random() * replies.length)];
                    
                    const replyElement = document.createElement('div');
                    replyElement.className = 'message received';
                    replyElement.innerHTML = `
                        <div>${randomReply}</div>
                        <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                    `;
                    
                    messagesArea.appendChild(replyElement);
                    messagesArea.scrollTop = messagesArea.scrollHeight;
                }, 1000);
            }
            
            // Attachment button
            document.getElementById('attachBtn').addEventListener('click', function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.png,.jpg,.jpeg,.pdf,.txt,.log';
                input.multiple = true;
                
                input.onchange = function(e) {
                    const files = e.target.files;
                    if (files.length > 0) {
                        alert(`Attached ${files.length} file(s)`);
                        // In real app, upload files and add to message
                    }
                };
                
                input.click();
            });
            
            // Call and video buttons (simulated)
            document.getElementById('callBtn').addEventListener('click', function() {
                alert('Voice call feature coming soon!');
            });
            
            document.getElementById('videoBtn').addEventListener('click', function() {
                alert('Video call feature coming soon!');
            });
            
            // Info button
            document.getElementById('infoBtn').addEventListener('click', function() {
                const name = document.getElementById('chatName').textContent;
                alert(`Conversation info for ${name}\n\nEncrypted: Yes\nMessages: 15\nLast active: Today`);
            });
            
            // Filter button
            document.getElementById('filterBtn').addEventListener('click', function() {
                alert('Filter conversations by:\n\n• Unread\n• Program admins\n• Researchers\n• Date');
            });
            
            // Search conversations
            const searchInput = document.querySelector('.conversations-search input');
            searchInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                let visibleCount = 0;
                
                conversations.forEach(conversation => {
                    const name = conversation.querySelector('.conversation-name').textContent.toLowerCase();
                    const preview = conversation.querySelector('.conversation-preview').textContent.toLowerCase();
                    
                    if (name.includes(query) || preview.includes(query) || query === '') {
                        conversation.style.display = 'flex';
                        visibleCount++;
                    } else {
                        conversation.style.display = 'none';
                    }
                });
                
                // Show/hide empty state
                const emptyState = document.getElementById('emptyConversations');
                if (visibleCount === 0 && query !== '') {
                    emptyState.style.display = 'block';
                } else {
                    emptyState.style.display = 'none';
                }
            });
            
            // Initialize
            messageInput.focus();
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl+N for new message
                if (e.ctrlKey && e.key === 'n') {
                    e.preventDefault();
                    openNewMessageModal();
                }
                
                // Escape to close modals
                if (e.key === 'Escape') {
                    if (newMessageModal.style.display === 'block') {
                        closeNewMessageModal();
                    }
                }
            });
        });
    </script>
</body>
</html>